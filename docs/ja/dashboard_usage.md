# 3dpmon 操作ガイド

## 動作仕様 
- Clarity K1/K1C/K1A/K1 Max シリーズに対応したブラウザベースの監視ツール
- WebSocket (標準ポート 9999) を利用してプリンタと通信
- カメラ映像、温度グラフ、印刷状態をリアルタイム表示
- 遠隔操作、ファイル管理、通知機能を搭載
- 設定や履歴はブラウザのローカルストレージに保存されます
- 準備時間、1層目確認時間、一時停止時間、使用フィラメント情報も
  印刷履歴に記録されます

## 操作説明 
1. リポジトリをダウンロードし、任意のフォルダに配置します
2. 静的 HTTP サーバーを起動します。例:
   ```
   python -m http.server 8000
   ```
3. ブラウザで `http://localhost:8000/3dp_monitor.html` を開きます
4. 右上の入力欄にプリンタの IP アドレスを入力して「接続」をクリック
5. ダッシュボード上で状態確認や操作を行います
## 初回接続手順 
起動直後はネットワーク設定が保存されていません。右上の入力欄に
プリンタの IP アドレスまたはホスト名を入力し、**接続** ボタンを
押してください。対応機種(K1/K2 シリーズ)ではポートは自動設定さ
れるため、IP のみで接続できます。カメラ映像は現在 `8080` ポート
のみ対応しており、`8000` は準備中です。

## 音声のアンロックとカスタマイズ 
ブラウザの仕様により、ユーザーが画面をクリックするまで音声を再生
できません。起動画面のどこでもクリックするとアンロックされ、右下
に音楽と音声のアイコンが表示されます。アイコンが斜線付きの場合は
無効、丸印なら有効で、通知時に音声や効果音が再生されます。設定
カードから好みに合わせてカスタマイズできます。

## 画面説明 
監視カードではカメラ映像と印刷操作をまとめて表示し、その他のカー
ドでファイル管理や温度調整、各種設定が行えます。プリンタから得ら
れる情報はすべてダッシュボード上に表示されます。

## 画面構成
- **タイトルバー** – プリンタ名や印刷状態を表示し、接続先 IP 入力欄と接続/切断ボタンがあります。音声が無効な場合はミュート表示が出ます。
- **監視カード** – カメラ映像、ヘッド位置プレビュー、印刷状態テーブル、停止・一時停止ボタンなどをまとめています。ノズルやベッド温度の調整、各ファンや LED の切り替えも行えます。
- **温度グラフ** – ノズルとベッドの温度推移を折れ線グラフで表示します。
- **機器情報カード** – 加速度制限やモデル情報、使用統計を確認できます。
- **ログカード** – 受信ログと通知ログをタブで切り替え、コピー用ボタンも備えています。
- **印刷履歴カード** – 印刷履歴一覧とファイル一覧タブがあり、G-code アップロードも可能です。
- **設定カード** – ストレージ設定や通知設定、コマンドパレットなどをまとめたエリアです。

## フィラメントスプール管理
- 設定カードの **追加** ボタンからスプールを登録します。ダイアログでは
  スプール名、総長さ、現在の残り長さを入力します。
- 旧データは起動時に自動で新形式へ変換されます。
- `dashboard_spool.js` の `addSpool()` に `manufacturerName` や
  `materialName` を指定すると、メーカー名や素材を管理できます。
- 印刷完了後は残量が自動更新され、3D プレビューで確認できます。
- `createFilamentPreview` 関数を使えば独自ページにも埋め込めます。
  登録ダイアログでは以下の項目を入力できます:
  - スプール名・サブ名
  - メーカー名 (任意)
  - 材料名と色名
  - 巻き長さと重量 (m/g は自動変換)
  - HEX カラーコード

  例: フィラメント登録時のオーバーレイ

  ```
  +-----------------------------+
  | Name        [Generic PLA ]  |
  | Sub Name    [Orange ]       |
  | Manufacturer[ACME]          |
  | Material    [PLA ] (+)      |
  | Length      [1.0] kg = 330m |
  | Color (#)   [#f97316]       |
  +-----------------------------+
  ```

  新しいメーカー名やカスタム素材を追加したい場合は、入力欄右側の [+] ボタンから
  直接登録できます。次回以降はプルダウンから選択可能です。
